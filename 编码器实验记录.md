# 编码器实验

## 一、 实验概述

编码器实验模块使用增量式光电编码器作为被测对象，涉及编码器**角度测量**和**频率测量**。实验采用步距角为1.8°的步进电机作为被测物，可以变成调动步进电机进行特定角度的转动。



## 二、 实验器材

NI ELVIS II/II+，ELVISBOX，编码器实验模块一个，编码器一个，编码器支架一个，步进电机一个，步进电机支架一个，联轴器一个，内六角螺丝刀一把，M3*6螺丝十个，M2*4螺丝四个，杜邦线四组

#### 【基本性能指标】

**编码器**

* 型号：欧姆龙E6A2-CWZ5C
* 计数方式：增量式
* 输出相位：A、B、Z
* 相位差：90+45°
* 工作电压12~24V
* 单圈脉冲数量：200

**步进电机**

* 工作电压：3.6V
* 内阻：6.2Ω
* 额定功率：2W
* 步距角：1.8°
* 保持转矩：0.02Nm
* 温升：85°Max



 ## 三、实验原理

### （一）旋转编码器（rotary encoder）

​     旋转编码器是将旋转位置或速度转换为数字讯号的机电设备，利用检测脉冲的方式来计算转速及位置，一般装设在旋转物体中垂直旋转轴的一面。旋转编码器用在许多需要精确旋转位置及速度的场合，如工业控制、机器人技术、专用镜头、电脑输入装置（如鼠标及轨迹球）等。

​     旋转编码器可分为绝对性（absolute）编码器及增量型（incremental）编码器两种。增量型编码器也称作相对型编码器（relative encoder），可输出有关旋转轴运动的信号，一般会由其他设备或电路进一步转换为速度、距离、每分钟转速或位置的信号。绝对型编码器会输出旋转轴的位置，可视为一种**角度传感器**。



增量式编码器是将位移转换成周期性的电信号，再把这个电信号转变成计数脉冲，用脉冲的个数表示位移的大小 



### 



## 四、实验内容

利用旋转编码器的反馈信号控制步进电机

1.控制步进电机转动

2.用编码器采集转动角度，测量步进电机步进角

3.观察编码器输出信号，计算编码器每圈输出脉冲数



## 五、 实验步骤

### （一）实验准备

#### 【ELVISbox准备】

1. 在桌上放置好NI ELVISII+，连接好电源线，再用USB线将其与电脑连接起来。（注意保证仪器上的两个开关均是关闭的）

2. 不用面包板，直接将ELVISBOX水平地插入NI ELVISII+对应的槽口上，注意下方也要卡入相应的卡槽内。

3. 将电源插头插入插座后，相继打开平台上的两个电源开关（分别在平台上方插头右侧和平台正面右上方）。接通后，平台正面右上方的“PROTOTYPING BOARD”处的POWER绿色指示灯会亮，并在一至两秒后“READY”黄色指示灯会亮；并且ELVISbox上右上方的“+15V”“-15V”“+5V”处的绿色指示灯也会亮起。在电脑上打开NI MAX界面，在“设备连接”里会显示“NI ELVISII+”，表示连接成功。之后关闭平台电源。

 

#### 【模块准备】

4. 用螺丝将附件中的编码器和步进电机安装到各自支架上，用螺丝锁紧。将装有编码器的支架用螺丝固定在实验模块上左侧位置；[^1]用内六角螺丝刀将联轴器固定在编码器中轴上备用，如下图。

   [^1]: 配套螺丝大小不合适

![8.1](https://github.com/HouRuizhe/Pictures-of-experiments-summaries/blob/master/P8.1.png) 

*Tip*：在将编码器中轴插入联轴器时，插入的深度刚好可以被六角螺丝固定即可，要使得联轴器与编码器支架的竖直平面保持一定距离，才不会影响到后续实验。[^2]

[^2]: 插入过长，编码器不会跟随步进电机转动。这与步进电机的转矩有关。 

5. 将步进电机安装在步进电机支架上如下图右，且不必将电机支架固定在模块上。

   ![8.2](https://github.com/HouRuizhe/Pictures-of-experiments-summaries/blob/master/P8.2.png)

之后将步进电机中轴固定在联轴器的另一侧，并用内六角螺丝刀拧紧。

![8.3](https://github.com/HouRuizhe/Pictures-of-experiments-summaries/blob/master/P8.3.png)

6. 关闭平台电源，插上编码器实验模块，开启平台电源，此时可看到模块左上角绿色的电源指示灯亮。

![8.4](https://github.com/HouRuizhe/Pictures-of-experiments-summaries/blob/master/P8.4.png) 

*Tip*：注意模块安装方向（如图）。本实验包含模拟部分和数字部分，左侧数字实验模块需使用Digital Slot1，右侧模拟实验模块需使用Analog Slot3，共占用两个插槽。

 

#### 【软件准备】

7. 打开nextpad，点击右上角的“配置”图标，在配置界面中选择“加载”；

![8.5](https://github.com/HouRuizhe/Pictures-of-experiments-summaries/blob/master/P8.5.png)

![8.6](https://github.com/HouRuizhe/Pictures-of-experiments-summaries/blob/master/P8.6.png) 

8. 在文件保存路径下，找到ELVISbox_Product Documentation_V1.0文件夹中的“nextmodule”文件夹，打开“nextsense”文件夹，再选择“编码器实验.nex”文件，并点击确定，等待系统自动加载完成；

![8.7](https://github.com/HouRuizhe/Pictures-of-experiments-summaries/blob/master/P8.7.png)

![8.8](https://github.com/HouRuizhe/Pictures-of-experiments-summaries/blob/master/P8.8.png) 

9. 加载完成后，点击窗口下方正中央的按钮即可返回主界面，在主界面的下方便有一行正方形的图标，可查看已安装的实验；

10. 运行编码器实验应用程序：在nextpad主界面中选择编码器实验图标，双击进入实验。

![8.9](https://github.com/HouRuizhe/Pictures-of-experiments-summaries/blob/master/P8.9.png)

11. 在“传感器实验”界面的右边点击“Refresh”按钮，听到继电器弹片吸合的声音（“嘀嘀”声），并在下面的显示框内有显示“Dev 1”,开始进行试验。若没有吸合音，请查看ELVIS设备是否选择正确以及线缆是否正确连接。

    

### （二）开始实验

#### 【编码器输出：使用编码器测量步进电机的转速】

软件切换到“编码器输出”选项卡

**Step1**：将编码器按照步骤1图示连接，即编码器引线插入模块<角度测量>区域的左排引脚。

*Tip*：引线只有一种方向能插入引脚中，插槽是不对称的。

**Step2**：将ELVISbox右上角信号引出端Al6+与模块<角度测量>区域的右排引脚CTR A连接。

**Step3**：选取编码器任意位置为标记位置（可以自行在编码器上做标记），记录起始角度值，角度值参考编码器支架上刻度。

**Step4**：点击开始按钮，用手逆时针（面朝编码器方向）拨动联轴器，观察波形图输出为脉冲信号，编码器计数值不断增加。记录终止角度值。

![8.10](https://github.com/HouRuizhe/Pictures-of-experiments-summaries/blob/master/P8.10.png) 

**Step5**：当前计数值表示编码器测量到的脉冲数量，根据编码器的脉冲精度（编码器每圈输出200个脉冲），可以计算【**换算角度=计数值*（360°/200）**】。

​       脉冲数量和换算角度可以手动填入选项卡中的表格，或点击“获取数据”，自动获取参数。【旋转角度=终止角度值-起始角度值】。

![8.11](https://github.com/HouRuizhe/Pictures-of-experiments-summaries/blob/master/P8.11.png)

**Step6**：将ELVISbox右上角信号引出端Al6+与模块<角度测量>区域的右排引脚CTR B连接，其它接线不变，重复Step2和Step3，观察现象与Step3相同。

**Step7**：将ELVISbox右上角信号引出端Al6+与模块<角度测量>区域的右排引脚CTR Z连接，其它接线不变，重复Step2和Step3，拨动编码器一圈，只输出一个脉冲，如下图所示。

![8.12](https://github.com/HouRuizhe/Pictures-of-experiments-summaries/blob/master/P8.12.png)

#### 【步进角测量：使用编码器测量步进电机转过的角度】[^3]

[^3]: 将编码器测量到的角度除以步进电机前进的步数可以获得电机的步进角 

软件切换到“步进角测量”

**Step1**：先将编码器和步进电机按步骤1图示连接，即编码器引线插入模块<角度测量>区域的左排引脚；步进电机引线插入模块<步进电机驱动>右排引脚。

*Tip*：<步进电机驱动>插槽也只允许引线一个方向插入。

**Step2**：选择步进电机工作方式和方向，单步执行时步进角为1.8°，半步执行时步进角为0.9°。选择“单步”、“逆时针”，点击“开始”按钮，观察联轴器运动方向为逆时针（面朝编码器方向）。

![8.13](https://github.com/HouRuizhe/Pictures-of-experiments-summaries/blob/master/P8.13.png) 

上图波形显示了步进电机四项的输出电平状态，当前步数表示步进电机前进的步数，角度指编码器测量到的电机转动角，角度为负数时代表电机正在正在逆时针转动。

**Step3**：点击“停止”按钮，点击“获取数据”按钮，将当前步数和角度自动添加进表格中。【**步进角=角度/步数**】。重复上述Step2和Step3步骤5次（在点击“开始”和点击“获取数据”之间间隔10s）计算结果接近步进电机步进角参数1.8°。

（由于步进电机和编码器中轴由于安装原因可能会处于错位情况，由于错位带来的测量误差可能达到0.2°左右。）

![8.14](https://github.com/HouRuizhe/Pictures-of-experiments-summaries/blob/master/P8.14.png)

 

## 六、 实验常见问题解答及注意事项

1. 为什么不将步进电机支架也固定在模块上？

​       答：由于操作差异，无法保证步进电机和联轴器的转轴完全处在同一水平线上，下图显示了同样附件由于不同的安装方式所导致的轴线偏差。为避免偏差过大导致无法连接编码器，因此建议只固定编码器支架，使步进电机处于自由状态，可以避免损坏联轴器。

![8.15](https://github.com/HouRuizhe/Pictures-of-experiments-summaries/blob/master/P8.15.png)

2. 为什么做步进角测量实验时会出现“当前步数”和“角度”不符合实际的情况，如角度一直在0.45°、0°和-0.45°之间跳变？

​       答：可能是因为联轴器与编码器的转轴相插太紧，致使联轴器在转动过程中没有带动编码器在转，而使编码器无法记录当前转过的角度。安装时，应使编码器转轴插入联轴器中的位置恰好能被内六角螺丝固定即可。

 